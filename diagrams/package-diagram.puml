@startuml Bookty E-Commerce Package Diagram

!define RECTANGLE class
skinparam packageStyle rectangle
skinparam defaultFontSize 11
skinparam package {
    BackgroundColor<<layer>> LightBlue
    BorderColor<<layer>> DarkBlue
    FontStyle<<layer>> bold
}

title Bookty E-Commerce System - Package Diagram

' ========== LAYERS (Top-Level Packages) ==========

package "User Interface Layer" as UI <<layer>> {
    
    package "Controllers" {
        package "Customer" {
            [HomeController]
            [BookController]
            [CartController]
            [CheckoutController]
            [ProfileController]
            [WishlistController]
            [ReviewController]
            [AboutController]
            [ContactController]
        }
        package "Auth" {
            [AuthenticatedSessionController]
            [RegisteredUserController]
            [PasswordController]
            [SocialiteController]
        }
        package "Admin" {
            [BookController]
            [OrderController]
            [CouponController]
            [FlashSaleController]
            [ReportsController]
            [CustomerController]
            [RecommendationAnalyticsController]
            [PostageRateController]
        }
        package "SuperAdmin" {
            [AdminController]
            [RoleController]
            [PermissionController]
            [SettingController]
        }
        package "Api" {
            [RecommendationController]
            [CouponController]
            [PostageController]
        }
        [ToyyibPayController]
    }
    
    package "Views" {
        [layouts]
        [home]
        [books]
        [cart]
        [checkout]
        [profile]
        [auth]
        [admin]
        [superadmin]
        [components]
    }
    
    package "Middleware" {
        [Authenticate]
        [EnsureUserHasCart]
        [Role Middleware]
        [permission:*]
    }
    
    package "Form Requests" {
        [ProfileUpdateRequest]
        [LoginRequest]
    }
}

package "Domain Layer" as Domain <<layer>> {
    
    package "Services" {
        [RecommendationService]
        [PostageRateService]
        [ToyyibPayService]
    }
    
    package "Observers" {
        [BookObserver]
    }
    
    package "Exports" {
        [ProfitabilityReportExport]
        [SalesReportExport]
    }
}

package "Data Access Layer" as DAL <<layer>> {
    
    package "Models" {
        package "Core" {
            [User]
            [Book]
            [Genre]
            [Trope]
        }
        package "Commerce" {
            [Order]
            [OrderItem]
            [Cart]
            [CartItem]
        }
        package "Promotion" {
            [Coupon]
            [CouponUsage]
            [FlashSale]
            [BookDiscount]
        }
        package "Engagement" {
            [Review]
            [Wishlist]
            [UserBookInteraction]
        }
        package "Shipping" {
            [PostageRate]
            [PostageRateHistory]
        }
        [Setting]
    }
}

package "Infrastructure" as Infra <<layer>> {
    database "MySQL Database" as DB
    [Cache]
}

package "External Systems" as Ext <<layer>> {
    [ToyyibPay API]
    [Google OAuth]
    [Email Service]
}

' ========== LAYER DEPENDENCIES ==========

UI ..> Domain : uses
Domain ..> DAL : uses
DAL ..> Infra : persists to
Domain ..> Ext : integrates with

' Key cross-package dependencies
[CheckoutController] ..> [PostageRateService]
[CheckoutController] ..> [ToyyibPayService]
[CheckoutController] ..> [Coupon]
[HomeController] ..> [RecommendationService]
[RecommendationController] ..> [RecommendationService]
[RecommendationAnalyticsController] ..> [RecommendationService]
[RecommendationService] ..> [Book]
[RecommendationService] ..> [OrderItem]
[RecommendationService] ..> [UserBookInteraction]
[BookObserver] ..> [RecommendationService]
[ReportsController] ..> [ProfitabilityReportExport]
[ReportsController] ..> [SalesReportExport]

@enduml
